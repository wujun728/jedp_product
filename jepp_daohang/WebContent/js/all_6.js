M("#activity",function(e,t){var n=e("#activity-imgs-switch"),r=n.query(".slide-item").length,i=1e4,s=function(){function f(n){if(!n){var i=e(".act-topic-list>li").first();t.appendChild(i)}e(".act-topic-list").animate({top:{from:0,to:-r+"px"}}),s=setTimeout(function(){f()},a)}var t=e(".act-topic-list"),n=e(".act-topic-list>li").length,r=e(".act-topic-list>li").first().getSize().height,i=0,s=0,o=0,u=1e4,a=1e4;n>1&&setTimeout(function(){e(".act-topic-list").delegate("li","mouseenter",function(){clearTimeout(s),clearTimeout(o)}).delegate("li","mouseleave",function(){o=setTimeout(f,a/2)}),f(!0)},u)},o=function(){if(e("[data-face]").length<=1)return;var t=function(){var t=e(".action-a"),n=e(".action-b"),r=e(".btn-tucao"),i=32,s=57,o=128,u=30,a=0,f=null,l={init:function(){var e=this;e.actionAAnim(),t.on("click",function(n){n.preventDefault(),t.css({"background-position":"0 0"}),e.actionBAnim()})},actionAAnim:function(){var e=this;e.frameAnim(t,i)},actionBAnim:function(){var e=this;n.css("top","0"),e.frameAnim(n,s)},frameAnim:function(e,t){var n=this;f&&(a=0,clearInterval(f)),f=setInterval(function(){if(a>=t){a=0,clearInterval(f),e.hasClass("action-a")&&n.actionAAnim(),e.hasClass("action-b")&&r.css({display:"block"});return}a++,e.css("background-position","0 -"+a*o+"px")},u)},reset:function(){clearInterval(f),n.css({"background-position":"0 0",top:"128px"}),r.hide()}};return l}(),n=function(t,n){var i,s=function(e){clearTimeout(i)},o=function(u){i=setTimeout(function(){r(n),e("[data-face="+t+"]").un("mouseenter",s).un("mouseleave",o)},1e4)};e("[data-face="+t+"]").on("mouseenter",s).on("mouseleave",o)},r=function(r){var i=e("[data-face="+r+"]");if(i[0]){e("[data-face]").fadeOut(200),i.fadeIn(100);var s=i.attr("data-autoTurnFace");s&&e("[data-face="+s+"]")[0]&&n(r,s),r=="a"?t.reset():r=="b"&&t.init()}};e("[data-face]").delegate("[data-clickTurnFace]","click",function(){r(e(this).attr("data-clickTurnFace"))})},u=function(){var t=new QW.Slide(g("activity-imgs-switch"),{animType:"fade",autoPlayTime:i,viewSelector:".slide-content div",autoPlay:!0,supportMouseenter:!0,mouseenterSwitchTime:300,selectedIndex:0,onbeforeswitch:function(t){var n=e(t.toView).query("img"),r=n.attr("data-src");!n.attr("src")&&r&&n.attr("src",r)}});n.hover(function(t){t.type=="mouseover"?e(".slide-btn").show():e(".slide-btn").hide()})};e(".act-topic-list")[0]&&s(),e("[data-face]")[0]&&o(),r>1&&u()});(function(){var e=new QW.Slide(g("important-news"),{animType:"fade",viewSelector:".important-news-item",autoPlay:!0,autoPlayTime:18e3,pageUpSelector:".prev",pageDownSelector:".next",supportMouseenter:!0,mouseenterSwitchTime:300,selectedIndex:0}),t=[],n=W("#important-news .g-list .cover"),r=n.length;while(r>0){r--;if(n.item(r).query(".g-pic-item").length<2)continue;t[r]=new QW.Slide(n[r],{animType:"fade",autoPlayTime:6e3,viewSelector:".g-pic-item",autoPlay:!0,supportMouseenter:!0,mouseenterSwitchTime:300,selectedIndex:0}),n.item(r).hover(function(e){e.type=="mouseover"?W(this).query(".slide-btn").show():W(this).query(".slide-btn").hide()})}})();M({container:"#hot-site"},function(e,t){var n=0;t.query(".site-group").forEach(function(t,n){var r=e(t).attr("data-zIndex");r&&e(t).css("z-index",r)}),e(".g-toggle").hover(function(t){clearTimeout(n);var r=e(this).parentNode(".site-group");n=setTimeout(function(){e(".group-list").hide(),QW.W(".group-list",r).show()},300)},function(){clearTimeout(n);var t=e(this).parentNode(".site-group");n=setTimeout(function(){QW.W(".group-list",t).hide()},300)}),e(".group-list").hover(function(t){clearTimeout(n),e(".group-list").hide(),e(this).show()},function(t){var r=this;n=setTimeout(function(){e(r).hide()},300)}),e(".mynav-icon").click(function(n){n.preventDefault();var r=QW.W("#hot-site").getRect().height-2;e(".mynav-iframe").css("height",r+"px"),e(".mynav-iframe iframe").attr("src","http://favorite.hao.360.cn/index.php?nocache="+Math.random()),e("#mynav").addClass("open"),t.tweet("mynav-open")}),e(".btn-close").click(function(n){n.preventDefault(),e("#mynav").removeClass("open"),t.tweet("mynav-close")})});M("#iguess",function(e,t){function a(t){n=t,e(".iguess-page>.on").removeClass("on"),e(".iguess-page>span").item(t).addClass("on")}function f(e){IGuess.get(function(n){n&&n.errno==IGuess.ERRORS.OK&&n.guess.length&&(s.setData(n).reRender(),t.tweet("changed-iguess-page",{pn:e}))},e+1)}function l(n,r){var i=e(".item[data-type="+n+"] .inner");if(r!==undefined)i.query(">.list").removeClass("on"),e(i.query(">.list")[r]).addClass("on");else{var s=i.query(">.on"),o=s.nextSibling(".list").length?s.nextSibling(".list"):i.query(">.list").first();s.removeClass("on"),o.addClass("on")}t.tweet("guess-showSites-changed")}function c(t){IGuess.getType(t,function(n){var r=n.sites,s=[];for(var a=0,f=r.length;a<f;a+=i){var c=[];r.slice(a,a+i).forEach(function(e){qboot.mix(e,{asin:"",res:"",aid:""}),c.push(o(u,e))}),s.push(['<ul class="list">',"</ul>"].join(c.join("")))}e(".item[data-type="+t+"] .inner").html(s.join("")).attr("data-time",+(new Date)),l(t,1)})}function h(e){if(!e.parentNode(".list").length)return;var t=e.parentNode(".item").attr("data-type"),n=e.attr("aid")||e.attr("siteid"),r=e.attr("asin")?2:1;return[t,n,r].join("_")}function v(){var t=[],n=[];e(".inner>.on a").forEach(function(r){var i=e(r).attr("aid"),s=parseInt(e(r).attr("siteid"));i&&!p.contains(i)&&(t.push(r),p.push(i)),s&&!d.contains(s)&&(n.push(r),d.push(s))});var r={adSites:t,notadSites:n};return r}function g(){var n=v(),r=n.adSites,i=n.notadSites,s=t.attr("data-v"),o=[],u=[];r.forEach(function(t){var n=e(t);o.push(n.attr("asin")),u.push(h(n))}),i.forEach(function(t){u.push(h(e(t)))});while(o.length){var a=o.splice(0,8);LogHub.iguessShowed(a,m)}u.length&&LogHub.newIguessShowed(u,s)}var n=0,r=+t.attr("data-totalPn")||1,i=6,s=R("iguess-wrap"),o=s.tmpl,u=QW.W("#iguess-link-template").html().trim();t.receive("changed-iguess-page",function(e){a(e.data.pn),t.tweet("guess-showSites-changed")}),t.receive("change-iguess-page",function(e){var t=e.data.toPn;f(parseInt(t))}),e(".iguess-page>a").click(function(i){i.preventDefault();var s=e(this).hasClass("iguess-pre")?"pre":"next",o=(n+r+(s=="pre"?-1:1))%r;t.tweet("change-iguess-page",{toPn:o})}),e(".iguess-page>span").forEach(function(t,n){e(t).attr("data-pn",n)}).click(function(n){n.preventDefault(),t.tweet("change-iguess-page",{toPn:e(this).attr("data-pn")})}),t.delegate(".item","mouseenter",function(){e(this).addClass("hover")}).delegate(".item","mouseleave",function(){e(this).removeClass("hover")}),t.receive("refresh-iguess-sites",function(t){var n=t.data.type,r=e(".item[data-type="+n+"]"),i=r.query(".inner");if(i.query(">.list").length==1){c(n);return}l(n),LogHub.iguess("refresh")}),t.delegate(".huan","click",function(n){n.preventDefault();var r=e(this).parentNode(".item"),i=r.attr("data-type");t.tweet("refresh-iguess-sites",{type:i})});var p=[],d=[];t.receive("iguess-clk",function(e){console.log(e);var t=e.data,n=t.link;LogHub.iguess("click",{text:n.html(),link:n.attr("href"),res:n.attr("res")||"",siteid:n.attr("siteid")||0,channel:"",asin:n.attr("asin")||"",tagid:"",st:t.st,dd:t.dd,ud:t.ud},!1)}),t.receive("iguess-clk",function(e){var n=e.data.link,r=h(n),i=t.attr("data-v");r&&LogHub.newIguessClk(r,i)});var m=0;t.receive("guess-showSites-changed",function(){setTimeout(g,500)});var y=timeMouseup=null;e("#iguess-wrap").delegate("a","click",function(n){var r=e(this),i=r.parentNode("div[data-time]").attr("data-time");t.tweet("iguess-clk",{link:e(this),dd:y,ud:timeMouseup,st:i}),timeMouseup=y=null}).delegate("a","mousedown",function(e){y=+(new Date)}).delegate("a","mouseup",function(e){timeMouseup=+(new Date)}),qboot.await(function(){return s.getStatus()==R.STATUS_OK},function(){t.tweet("guess-showSites-changed")},function(){},500,600)});M("#top-channel",function(e,t){function c(t,n,r){var i="slide"+n;for(var s in t)!t[s]||(t[s].autoPlayPausing=!0);!t[i]||r?t[i]=new QW.Slide(e("#channel-news .tabview-cont .cover")[n],{animType:"fade",autoPlayTime:1e4,tabSelector:".slide-nav li",viewSelector:".slide-content div",pageUpSelector:".slide-pageup",pageDownSelector:".slide-pagedown",autoPlay:!0,supportMouseenter:!0,mouseenterSwitchTime:300,autoPlayPausing:!1,selectedIndex:0}):t[i].autoPlayPausing=!1}var n=QW.TweetH,r=HAO_CONFIG.feedsConfig.channeltop,i=new AppData("api.hao.360.cn",r.r),s=i.get(r.api,!0),o=s&&i.getUpdatedTime(r.api)||0,u=parseInt(t.attr("data-updatetime")),a=(new Date).getTime(),f=3e5;(!s||o<u)&&e("#channel-news .tabview-wrap .channel-data-default").replaceClass("channel-data-default","tabview-cont").addClass("on");var l={slide0:null,slide1:null,slide2:null,slide3:null};t.receive("channeltop-ok",function(t){function u(e,t){t.length>1&&e.query(".slide-content").insertAdjacentHTML("beforeend",t[0]).insertAdjacentHTML("afterend",t[1])}window.___topchannel_mock____data=t.data;var n=hao360.showChannelTop(t.data.channelTopData,t.data.flush?0:1),r="#channel-news .section-bd",i=QW.W("#news-tips"),s=e(r);t.data.flush&&s.query(".tabview-cont").removeNode(),s.html(s.html()+n);var o="#channel-news .tabview-tabs>li";t.data.flush&&(e(o).item(0).hasClass("on")||e(o).removeClass("on").item(0).click()),e(o).forEach(function(n,r){var i=e("#channel-news .tabview-cont .cover"),o=hao360.htmlForChannelTopSlide(t.data.channelTopData[r]);u(i.item(r),o),e(n).hasClass("on")&&(e(QW.W(".tabview-cont",s)[r]).addClass("on"),c(l,r,!0));var a=i.item(r);a.hover(function(e){a.query(">a").show()},function(e){a.query(">a").hide()}),e(n).on("click",function(e){c(l,r)})})}),Feed.channeltop(function(e){e=e.data,t.tweet("channeltop-ok",{channelTopData:e}),TimeSVC.getTime(function(t){var n=t.getTime();Math.abs(a-n)<f&&i.set(r.api,e[0])})},{cache:!1}),n.receive(document,"news-read",function(e){var n=e.data.last_modify_time*1e3;e=e.data.data,t.tweet("channeltop-ok",{channelTopData:e,flush:!0}),QW.W("#top-channel").attr("data-news-readtime",n)}),e("#channel-news").tabview(),e("#channel-news").delegate("a","click",function(e){LogHub.channeldata("click",{cate:"news",text:this.innerHTML,link:this.href})})});M("#user-channel",function(e,t){function u(n){var r=n.data.channel,i="#channel-"+r,u="channelview-"+r,a=s[r],f=R(u);if(!f)return;setTimeout(function(){f.getStatus()!=R.STATUS_OK&&t.tweet("get-channel-data",{channel:r})},o),qboot.await(function(){return f.getStatus()==R.STATUS_OK},function(){t.tweet("channel-data-render",{channelId:r}),UserChannelSwitch.dealSwitchEntry(r,0,0),e(i).tabview(a!==undefined,{delayTime:a})},null,100,100)}var n=hao360.showedChannel,r=HAO_CONFIG.channelOrder,i=(new AppData("api.hao.360.cn",r.r)).get(r.api);!i&&hao360.mid&&Channel.getOrder(function(e){t.tweet("channelOrder-ok",{order:e.slice(0,4)})}),function(){var n=function(){var n={},r={},i=hao360.showedChannel,s=[],o=function(){for(var e=0,t=i.length;e<t;e++){var n=i[e];if(s.indexOf(n)==-1)continue;r[n]={prevTabIndex:0,currentTabIndex:0,slideEntry:[0,0,0,0]}}};n.dealSwitchEntry=function(t,n,i){var s=r[t];if(s===undefined)return;var o=s.slideEntry[n];s.currentTabIndex=n||0,s.prevTabIndex=i||0,s.currentTabIndex!==s.prevTabIndex&&(s.slideEntry[s.prevTabIndex].onbeforeswitch=function(){return!1});if(o==0){var u=e("#channel-"+t+" .tabview-cont .cover");u.query(".mask").removeNode(),s.slideEntry[n]=new QW.Slide(u[n],{animType:"fade",autoPlayTime:1e4,tabSelector:".slide-nav li",viewSelector:".slide-content div",pageUpSelector:".slide-pageup",pageDownSelector:".slide-pagedown",autoPlay:!0,supportMouseenter:!0,mouseenterSwitchTime:300,selectedIndex:0})}else s.slideEntry[n].onbeforeswitch=function(){return!0}};var u=function(){for(var e in r)n.dealSwitchEntry(e,0,0)},a=function(){o(),u()},f=function(){t.delegate("li.cover","mouseover",function(){var t=e(this).parentNode("div.section").attr("data-channel");(t==null||s.indexOf(t)!=-1)&&e(this).query("a.slide-btn").show("block")}),t.delegate("li.cover","mouseout",function(){e(this).query("a.slide-btn").hide()})};return n.initialize=function(){var n=e("#channel-white-list").val();n!=""&&(s=n.split("|")),t.receive("channels-choosed",function(e){i=e.data.channels,setTimeout(function(){a()},300)}),o(),f()},n}();QW.provide("UserChannelSwitch",n),n.initialize(),QW.TweetH.receive(document,"tabview-change",function(e){var t=e.data,r=t.channelName,i=Math.max(0,t.currentTabIndex),s=Math.max(0,t.prevTabIndex);n.dealSwitchEntry(r,i,s)})}();var s={video:0,mall:1e4},o=6e3;t.receive("get-channel-data",function(e){var t=e.data.channel,n="channelview-"+t;Channel.getChannel(t,function(e){var r=e&&e.data&&e.data[t];R(n).setData(r).reRender()},{_r:Math.random()})}),function(){var n,r=15,i,s=[],o=function(t){var o,u=n,a=function(){var n=e("#channelview-mall .tabview-cont:first-child li:last-child a");try{if(u.errno)return;u=u.info[r],s=[];for(o=0;o<u.length;o++)e(n[o]).html(u[o][0]).attr("href",u[o][1]).attr("title",u[o][2]).attr("asin",u[o][3]).attr("aid",u[o][4]),s.push(u[o][3]);i=i||+(new Date)}catch(a){t=function(){}}t&&t()},f=setInterval(function(){R("channelview-mall").getStatus()===R.STATUS_OK&&(a(),clearInterval(f))},40)},u=function(){var t=".tabview-cont:first-child li:last-child a[asin]",n=timeMousedown=null;e("#channelview-mall").delegate(t,"click",function(t){var r=e(this),s=r.attr("asin");s&&LogHub.iguess("click",{asin:s,st:i,dd:timeMousedown,ud:n})}).delegate(t,"mousedown",function(e){n=+(new Date)}).delegate(t,"mouseup",function(e){timeMousedown=+(new Date)})},a=function(){s.length&&LogHub.iguessShowed(s)},f=function(e){var t="http://tf.360.cn/guess/api.js",n='{"'+r+'":2}',i=8,s=217,o=1;e=e||function(){},qboot.jsonp(t,{info:n,cid:i,pid:s,stat:o},e,{jsonp:"cb",timeout:2e3})};t.receive("channel-data-render",function(e){var t=e.data.channelId;t==="mall"&&(n?o():f(function(e){n=e,o(function(){u(),a()})}))})}(),t.receive("channel-to-render",u),n.forEach(function(e){t.tweet("channel-to-render",{channel:e})}),e(".retry").click(function(n){n.preventDefault();var r=e(this).parentNode(".section").attr("data-channel");t.tweet("get-channel-data",{channel:r})});var a={},f=[],l=1,c=hao360.showedChannel;if(c.length>0)while(c[l-1])a[c[l-1]]=l,f.push(l+"_"+c[l-1]),l++;LogHub.channeldata("pv",{pm:f.join(",")}),e("[data-channel]").forEach(function(t,n){var r=e(t).attr("data-channel");e(t).delegate("a","click",function(e){LogHub.channeldata("click",{cate:r,text:this.innerHTML,link:this.href,p:a[r]})})})});M("#channel-sort",function(e,t){function w(e){LogHub.behavior("channelSort",e)}function T(e){var t=[];for(var n=0,r=e.cover.length;n<r;n++)t.push(e.cover[n].pic+"-"+e.cover[n].text);for(var n=0,r=e.rows.length;n<r;n++){var i=e.rows[n].items;for(var s=0,o=i.length;s<o;s++)i[s].text!=""&&t.push(i[s].highlight+"-"+i[s].text)}return t.join("")}function L(){qboot.cookie.set(C,N,{expires:2592e6})}var n=QW.TweetH,r=e("#sort-toggle"),i=r.query(".txt"),s=i.html().trim(),o=r.hasClass("open")?"show":"hide",u=e(".sort-panel"),a=e(".sort-tips"),f=e("#news-tips"),l=e(".error-info"),c="\u4eb2\uff0c\u53ea\u80fd\u9009\u62e9<em>4</em>\u4e2a\u54e6\uff0c\u53bb\u6389<em>n</em>\u4e2a\u5427",h="\u4eb2\uff0c\u53ef\u4ee5\u9009\u62e9<em>4</em>\u4e2a\u54e6\uff0c\u518d\u6765<em>n</em>\u4e2a\u5427",p=QW.W("#user-channel"),d=parseInt(p.attr("data-channelheight")),v=p.attr("data-defaultorder").split(","),m=hao360.showedChannel,g=hao360.channelOrder,y=HAO_CONFIG.userChannel,b=new AppData("api.hao.360.cn",y.r),E=0,S={status:o,setTitle:function(){e(".sort-list>[data-key]").attr("title","\u70b9\u51fb\u9009\u4e2d"),e(".sort-list>.channel-select").attr("title","\u70b9\u51fb\u53d6\u6d88\u9009\u4e2d")},showNewsTips:function(){f.attr("data-showing")==="1"&&(f.show(),t.tweet("page-height-resize"))},showTips:function(e,n){var r=this;a[0].__preAnim&&a[0].__preAnim.end(),clearTimeout(E),e&&a.query(".sort-tips-text").html(e),f.hide(),a.show().animate({height:{from:0,to:"30px"}},200,function(){t.tweet("page-height-resize")}),n&&(E=setTimeout(function(){a.slideUp(400,function(){a.hide(),r.showNewsTips(),t.tweet("page-height-resize")})},n))},showOK:function(){e(".sort-tips-text").attr("data-ctrl",""),S.showTips('<em class="orange">\u592a\u68d2\u4e86\uff0c\u5df2\u7ecf\u9009\u62e9\u6210\u529f\u5566</em>',2e3)},show:function(){a[0].__preAnim&&a[0].__preAnim.end(),m.forEach(function(t){e(".sort-list>[data-key="+t+"]").addClass("channel-select")}),S.setTitle(),r.addClass("open"),i.html("\u8fd4\u56de"),u.show(),a.hide(),t.tweet("page-height-resize"),S.status="show"},hide:function(){r.removeClass("open"),i.html(s),u.hide(),e(".sort-list>.channel-select").removeClass("channel-select"),S.status="hide"},saveChannels:function(){var n=e(".channel-select"),r=n.length,i=[];if(r<4){l.html(h.replace("n",4-r));return}if(r>4){l.html(c.replace("n",r-4));return}l.html(""),n.forEach(function(t){var n=e(t).attr("data-key");i.push(n)}),i.sort().join()!=m.sort().join()?(m=i,t.tweet("channels-choosed",{channels:i})):(t.tweet("sort-panel-hide"),S.showOK())},renderChannels:function(e){p.query(".channel-bd>.section").css({display:"none"});var n=0,r=[];g.forEach(function(e){m.contains(e)&&(r.push(e),p.query("#channel-"+e).css({top:n+"px",display:"block"}),p.query("#channelloading-"+e).css({display:"block"}),n+=d)}),b.set(y.api,r),e.forEach(function(e){var n="channelview-"+e,r=R(n);r&&(Channel.getChannel(e,function(t){var n=t&&t.data&&t.data[e];r.reRender(null,n)}),t.tweet("channel-to-render",{channel:e}))}),t.tweet("sort-panel-hide"),S.showOK()}};t.receive("sort-panel-show",function(e){S.show()}),t.receive("sort-panel-hide",function(e){S.hide()}),r.click(function(e){e.preventDefault(),t.tweet("sort-panel-"+(S.status=="show"?"hide":"show"))}),e(".cancel-sort-btn").click(function(e){e.preventDefault(),t.tweet("sort-panel-hide")}),t.delegate("[data-ctrl=open-sort]","click",function(e){e.preventDefault(),t.tweet("sort-panel-show")});var x=!1;QW.W("#top-channel").on("mouseenter",function(){x=!0}),QW.W("#top-channel").on("mouseleave",function(){x=!1});var N,C="msgMaxId",k;n.receive(document,"message-push",function(e){e=e.data;if(e.data===undefined)return;var t=e.data.news;N=e.max_id;if(t&&!!t[0].t){var r=HAO_CONFIG.feedsConfig.channeltop,i=new AppData("api.hao.360.cn",r.r),s=i.get(r.api,!0),o=s===undefined?"":T(s);Feed.channeltop(function(e){var t=QW.W("#top-channel").attr("data-news-readtime"),s=e.last_modify_time*1e3,u=e.data[0]===undefined?"":T(e.data[0]);s>t&&o!=u&&!x?(LogHub.behavior("messagePush","newsShow"),LogHub.behavior("messagePush","readNews"),k=e,N!==undefined&&L(),k&&n.tweet(document,"news-read",k),i.set("newsReadTime",s),i.set(r.api,e.data[0])):L()},{cache:!1,params:{_t:N}},DataCache.FLUSH)}}),t.receive("channels-choosed",function(e){S.renderChannels(e.data.channels)}),t.delegate(".sort-list>a","click",function(t){t.preventDefault(),l.html(""),e(this).toggleClass("channel-select"),S.setTitle()}),e(".save-sort-btn").click(function(e){e.preventDefault(),S.saveChannels()});var A=e(".sort-tips-text").html().trim();if(A){var O=hao360.md5(A),M="channelSort_tips",_=a.attr("data-expires"),D=(qboot.cookie.get(M)||"").split("|"),P=parseInt(D[0]||0),H=D[1],B=a.attr("data-ignore"),j=6048e5;_&&/^\d{4}\/\d{2}\/\d{2}$/.test(_)&&(j=new Date(_)-new Date);function F(t){if(j<=0)return;if(m.contains(B))return;e(".sort-tips-text").attr("data-ctrl","open-sort"),setTimeout(S.showTips,2e3),qboot.cookie.set(M,[t||1,O].join("|"),{expires:j})}O!=H?(qboot.cookie.remove(M),F()):P<3&&F(P+1),t.receive("sort-panel-show",function(){qboot.cookie.set(M,[3,O].join("|"),{expires:j})})}t.delegate("#sort-toggle .txt","click",function(t){t.preventDefault(),e(this).html()=="\u6362\u4e00\u4e0b"?w("back"):w("change")}).delegate(".cancel-sort-btn","click",function(e){e.preventDefault(),w("cancel2back")}).delegate('.sort-tips-text[data-ctrl="open-sort"]',"click",function(e){e.preventDefault(),w("tipsClick")}),t.receive("channels-choosed",function(e){var t=e.data.channels;t.forEach(function(e){w("choose-"+e)})})});M("#category-service",function(e,t){t.query(".panel").hover(function(t){var n=e(this);n.toggleClass("hover-panel","")})});M("#cool-site",function(e,t){e(".panel .item").hover(function(t){e(this).toggleClass("hover")})});function setLazySwitchable(e){var t="#"+e,n=W(t).query(".widget-slide-inner"),r=W(t).query(".widget-slide-inner .slide-column-inner").length;r>1&&(W(t).query(".widget-slide-inner .slide-column-pageup").show(),W(t).query(".widget-slide-inner .slide-column-pagedown").show(),n.switchable())}var SERVICE_CONFIG={cateData:{host:HAO_CONFIG.loulouView.host,v:{"gouwu-tab1":"1.2","gouwu-tab2":"1.2","gouwu-tab3":"1.0","youxi-tab2":"1.2","youxi-tab3":"1.2","youxi-tab4":"1.2","video-tab1":"1.3","video-tab2":"1.3","video-tab3":"1.3","relax-tab1":"1.4","relax-tab2":"1.1","relax-tab3":"1.2","relax-tab4":"1.3","localcity-tab1":"1.0"}},adData:{host:HAO_CONFIG.loulouAD.host,v:{"youxi-tab1":"1.0"}}},ServiceModule=function(){var e={plugins:{}},t=function(){return function(e,t){var n=SERVICE_CONFIG.cateData,r=SERVICE_CONFIG.adData,i={};r.v[e]?(n=r,i={v:n.v[e]||1,key:e,c:"index",a:"hao360cnBottomView",huid:encodeURIComponent(qboot.cookie.get("__huid")),mid:hao360.mid,type:70}):i={v:n.v[e]||1,key:e},hao360.channel!=""&&(i.fromid=hao360.channel);var s=Bus.register({},n,!0),o=qboot.when.defer();return s.request(i,function(e){e&&e.data?o.resolve(e.data):o.reject()}),o.promise}}(),n=function(e){window.moniter&&moniter.setId(e)},r=function(e,r){var s=e.getAttribute("data-tab-cate");if(!s||e.getAttribute("data-ok"))return;var o=!0;setTimeout(function(){o&&r.query(".loading").show()},1e3),t(s).then(function(t){o=!1,r.query(".loading").hide(),e.innerHTML=t,n([e.id]),e.setAttribute("data-ok",1),e.setAttribute("data-time",+(new Date)),i(s)})},i=function(t){if(t==undefined)return;var n=t.split("-")[1];t=t.split("-")[0];var r=e.plugins[t];if(r==undefined)return;for(var i=0,s=r.length;i<s;i++)r[i].init&&r[i].init(n)},s=function(e){var t=e.attr("data-cate"),n=e.query(".widget-slide"),i="service-"+t+"-tabNo";if(!n.length){var s=e.query("div[data-tab-cate]")[0];r(s,e);return}n.switchable({onbeforeswitch:function(t){var n=t.toView;r(n,e)},onafterswitch:function(t){Browser.ie7&&W(t.toView).css("filter","none"),e.query(".loading").hide(),qboot.cookie.set(i,t.toIndex)}}),n[0].__slide.switchTo(~~qboot.cookie.get(i))},o=function(e){W(e).query(".service-tab li").on("click",function(e){var t=W(this);if(t.hasClass("selected")){var n=t.query("a").attr("href");n&&n!="#"&&window.open(n)}})},u=function(e){var t=W(e),n=t.query("TEXTAREA");n.length&&(t.html(n.item(0).val()),s(t),o(t))},a=function(){var e={lazyloaderType:"blocker",threshold:100,onbeforeload:function(){var e=this.getCurrent()},onafterload:function(){var e=this.getCurrent();s(e),o(e)}};W(".service-panel,#localcity").forEach(function(t){var n=t.id;window.serviceWhiteList&&n&&serviceWhiteList.contains(n)?DomU.ready(function(){u(t)}):new lazyLoader(W(t),e)})};return e.addPlugins=function(t,n){return t in e.plugins||(e.plugins[t]=[]),e.plugins[t].push(n),this},e.init=function(){a()},e}(),AdLog=function(){function n(n,r){var i=[],s=[];W(n).query("a").forEach(function(n){var r=W(n).attr("aid"),o=parseInt(W(n).attr("siteid"));r&&!e.contains(r)&&(i.push(n),e.push(r)),o&&!t.contains(o)&&(s.push(n),t.push(o))}),r=r||[],r.forEach(function(t){var n=W(t).attr("aid");e.contains(n)&&(i.remove(t),e.remove(n))});var o={adSites:i,notadSites:s};return o}function r(e){if(!e.parentNode(".service-type").length)return;var t=e.parentNode(".service-type").attr("data-type"),n=e.attr("aid");return[t,n].join("_")}function s(e,t){var s=n(e,t),o=s.adSites,u=[],a=[];o.forEach(function(e){var t=W(e);u.push(t.attr("asin")),a.push(r(t))});while(u.length){var f=u.splice(0,8);LogHub.iguessShowed(f,i)}a.length&&LogHub.newIguessShowed(a)}var e=[],t=[],i=0;return{linkData4Log:r,sendShowedLog:s}}();ServiceModule.addPlugins("youxi",{init:function(e){function i(e){var t=e.query(">.g-list>.on"),n=t.nextSibling("li").length?t.nextSibling("li"):e.query(">.g-list>li").first();t.removeClass("on"),n.addClass("on"),AdLog.sendShowedLog(n)}var t="#service-youxi-hot",n=W(t).query(".service-iguess li:not(.on) a");AdLog.sendShowedLog(t,n),W(t).query(".huan").on("click",function(e){e.preventDefault();var t=W(this).parentNode(".item"),n=t.query(">.service-iguess-inner");i(n)});var r=timeMousedown=null;W(t).delegate("a[asin]","click",function(e){var t=W(this),n=t.attr("asin"),i=t.parentNode(".service-type").attr("data-type");if(n){var s=t.parentNode("div[data-time]").attr("data-time");LogHub.iguess("click",{asin:n,type:i,st:s,dd:timeMousedown,ud:r},!1),LogHub.newIguessClk(AdLog.linkData4Log(t))}}).delegate("a","mousedown",function(e){r=+(new Date)}).delegate("a","mouseup",function(e){timeMousedown=+(new Date)})}}),ServiceModule.addPlugins("relax",{init:function(e){setLazySwitchable("service-relax-moment")}}),ServiceModule.addPlugins("localcity",{init:function(e){setLazySwitchable("localcity-tab1")}}),ServiceModule.addPlugins("gouwu",{init:function(e){if(e!=="tab1")return;var t=["517ac529c60744ac","341e7281b0f6f274","c86a7bf6582d2b4d","3548461020e2ba44","a8cced9175bd07bc","85d6177a9aa6adea","87ea520aefaaf92c"],n,r="http://v.tf.360.cn/v/w.json?mp=1&_=",i=this;for(n=0;n<t.length;n++)t[n]="pic-"+n+","+t[n];r+=t.join("|"),qboot.jsonp(r,function(e){e.msg&&e.errno===0&&(i.render(e.data),i.initEvent(e.data.pv))},{jsonp:"callback"})},initEvent:function(e){W("#service-gouwu-mall").delegate(".service-pic a[asin]","click",function(){var e=W(this).attr("asin")||"";e&&logSender(e)}),e&&logSender(e)},render:function(e){var t=W("#service-gouwu-mall .service-pic li");t.forEach(function(t,n){var r=W(t),i=e["pic-"+n];if(!i)return;r.query("img").attr("src",i.pic),r.query(".txt").html(i.title),r.query("a").attr({href:i.link,asin:i.stats.clk})})}}),ServiceModule.init();M("#mysite",function(e,t){var n=new MysiteSvc,r=ObjectH.mix,i=ObjectH.isArray,s=ObjectH.isFunction,o="add-success",u="site-input-error",a=QW.W("#mysite-list").attr("data-key"),f=e("#edit-mysite"),l=e(".mysite-list-null"),c=e("#tab-list"),h=e("#reco-list"),p=29,d=null,v=t.query(".tips-success"),m=t.query(".tips-cancel"),g=t.query(".tips-error"),y=t.query(".tips-warning"),b='<div class="g-tips g-tips-right tips-reco {$display}" style="right:-{$right}px"><div class="cont">{$tip}</div><!--[if lte IE 7]><span class="arrow-border"></span><span class="arrow-background"></span><![endif]--></div>',w='<li class="{$className} {$type}" data-key="{$key}"><a href="" onclick="return false;">{$tab}<span class="mark">{$type}</span></a></li>',E='<div class="line"><span class="split">\u2022</span><h3 class="title {$type}"><span class="cont">{$title}<span class="mark">{$type}</span></span></h3></div>',S='<li data-sid="{$sid}" class="{$className}"><a href="{$url}" class="{$color}"><span class="name">{$name}</span>'+b+"</a></li>",x='<li style="display:{$display}"><div class="item"><a href="{$url}" class="site"><img src="{$favicon}" class="favicon"><span>{$name}</span></a><a href="###" class="btn delete-site" data-sid="{$sid}" data-id="{$id}" title="\u5220\u9664">\u5220\u9664</a></div></li>',T=n.ERRORCODE,N=qboot.when,C={cache:{},getNameByByte:function(e){var t="",n=8;e.byteLen()>=10?t=e.subByte(n):t=e;var r=t.split(""),i=/^[a-z0-9A-Z]$/,s=0;return r.forEach(function(e){i.test(e)&&s++}),s&&(t=t.subByte(n-Math.ceil(s*.4))),e!=t&&(t+="..."),t},renderCustomSites:function(e){var t=this,n=e&&e.sid||null,i=e&&e.type||null;mysiteService.getCustomSites().then(function(e){var s=e.length,o=null,u=[];for(var a=0;a<s;a++){var c=r({},e[a]);c.name=t.getNameByByte(c.name),n==c.sid&&i=="add"?(o=a,u.push(x.tmpl(r({display:"none"},c)))):u.push(x.tmpl(c))}var h=u.join("");f.html(h),s?(l.hide(),f.show()):(l.show(),f.hide());if(o!=null){var c=f.query("li").item(o);i=="add"&&c.fadeIn()}}).otherwise(function(){l.show(),f.hide()})},filter:function(e,t){for(var n=0,r=t.length;n<r;n++){var s=t[n];if(i(s)){var u=s[2],a=s[3];s=new SiteEnt(s[0],s[1])}u&&(s.color=u),e==s.sid&&(s.className=o),a&&(s.tip=a,s.display="show",s.right=a.byteLen()*6+16),s&&(t[n]=s)}return t},reFilterRecoSites:function(e,t,n){var r=function(e){e.removeClass(o)};n&&n=="add"&&(r=function(e){e.addClass(o)});for(var i=0,s=t.length;i<s;i++){var u=t.item(i);u.attr("data-sid")==e&&r(u)}},switchRecommendSites:function(e,t){var n=this,r=!1;setTimeout(function(){!r&&!t.preload&&(h.query(".reco").hide(),h.query(".loading").show())},500),mysiteService.getRecommendSites(e).then(function(i){if(t.preload)return;r=!0,h.query(".loading").hide();var o=i.current,u=o&&o.key,a=o&&o.url;n.renderRecoTabs(i.category,e),n.switchRecoTab(u),n.renderRecommendSites(a,u),s(t.callback)&&t.callback()})},renderRecommendSites:function(e,t){var n=this;mysiteService.getCustomSites().then(function(r){var i=['<div class="reco" data-type="'+t+'">'];for(var s=0,o=e&&e.length;s<o;s++){var u=e[s][0],a=e[s][1];if(!u[0])continue;var f={};f.type=u[1],f.title=u[0];var l=E.tmpl(f);res=[l+'<ul class="gclearfix">'];if(r.length==0)n.filter(null,a);else for(var c=0,p=r.length;c<p;c++){var d=SiteEnt.getSid(r[c].url);n.filter(d,a)}for(var c=0,p=a.length;c<p;c++){if(!a[c].name)continue;res.push(S.tmpl(a[c]))}res.push("</ul>"),i.push(res.join(""))}i.push("</div>");var v=i.join("");h.query(".reco").hide(),h.query(".loading").hide(),h.html(h.html()+v),n.cache[t]='div[data-type="'+t+'"]'})},initRecommendSites:function(e,t){h.query("ul[data-type]").hide();var n=e||a;this.cache[n]?(h.query(".reco").hide(),h.query(".loading").hide(),h.query(this.cache[n]).show()):this.switchRecommendSites(n,{callback:t})},renderRecoTabs:function(e,t){if(this.cache.tab)return;var n=[];for(var r=0,i=e.length;r<i;r++){var s={},o=e[r];if(!o[1])continue;s.key=o[0],s.key==t&&(s.className="cur"),s.type=o[2],s.tab=o[1];var u=w.tmpl(s);s.key==a?n.unshift(u):n.push(u)}c.html(n.join("")),this.cache.tab=!0},switchRecoTab:function(t){var n=e("#tab-list"),r=n.query("li");t=t||a,t&&(r.removeClass("cur"),n.query("li[data-key="+t+"]").addClass("cur")),this.tipsHide([v,y,g,m])},renderPanel:function(e){this.renderCustomSites(),e=e||a,this.initRecommendSites(e)},relateToMysiteAndRecommandsite:function(t,n,r){this.renderCustomSites({type:n,sid:t}),siteList=e("#reco-list li"),this.reFilterRecoSites(t,siteList,n),n=="add"&&r?e(document).tweet("mysite:add-site",{name:r.name,url:r.url,domain:r.domain,type:1}):n=="delete"&&e(document).tweet("mysite:delete-site",{id:r.id,sid:t})},customSitesIsNotFull:function(){var t=N.defer(),n=MysiteLocalData.order.length;if(n<p){var r=p-n;t.resolve(r)}else y.query(".cont").html("\u6682\u65f6\u53ea\u80fd\u6dfb\u52a0\u8fd9\u4e48\u591a\u7f51\u5740\u4e86"),this.tipsShow(e(".mysite-title"),y,{height:11,width:500,time:5e3});return t.promise},addSite:function(t,r){t.type=1,type=r&&r.type||"click";var i=this,s=function(n){var s=[];if(type=="form"){var o=r&&r.form||e("form")[0];placeholderHook(o.sitename).setVal(""),placeholderHook(o.siteurl).setVal(""),o.sitename.focus(),s=[v,y,g]}else if(type=="click"){var u=r&&r.el;i.tipsShow(u,v),s=[y,g]}var a=n.res,f=n.res.sid;t.domain=a.domain,i.relateToMysiteAndRecommandsite(f,"add",t),i.tipsHide(s)},o=function(e){i.errorTips(e.errCode)};i.customSitesIsNotFull().then(function(){n.add(t,function(e){e.errCode==T.NoError?s(e):o(e)})})},errorTips:function(n){var r=this,i=t.query(".site-name"),s=t.query(".site-url"),o=function(e,t,n){i.addClass(u),g.query(".cont").html("\u8bf7\u8f93\u5165\u7f51\u7ad9\u540d\u79f0"),r.tipsShow(i,g,{callback:function(){i.removeClass(u)}})};switch(n){case T.NameIsNull:i.addClass(u),g.query(".cont").html("\u8bf7\u8f93\u5165\u7f51\u7ad9\u540d\u79f0"),r.tipsShow(i,g,{callback:function(){i.removeClass(u)}});break;case T.UrlIsNull:s.addClass(u),g.query(".cont").html("\u8bf7\u8f93\u5165\u7f51\u5740"),r.tipsShow(s,g,{callback:function(){s.removeClass(u)}});break;case T.NameLengthErr:i.addClass(u),g.query(".cont").html("\u60a8\u8f93\u5165\u7684\u540d\u79f0\u8fc7\u957f"),r.tipsShow(i,g,{callback:function(){i.removeClass(u)}});break;case T.UrlLengthErr:s.addClass(u),g.query(".cont").html("\u60a8\u8f93\u5165\u7684\u7f51\u5740\u8fc7\u957f"),r.tipsShow(s,g,{callback:function(){s.removeClass(u)}});break;case T.SiteIsExist:y.query(".cont").html("\u8be5\u7f51\u5740\u5df2\u5b58\u5728"),r.tipsShow(e(".mysite-title"),y,{height:11,width:500,time:5e3});break;case T.SidIsNull:alert("sid is null");break;case T.SiteIsNotExist:alert("site is not exist");break;default:alert("\u4fc4\u4e5f\u5e03\u5409\u5c9b\u662f\u80bf\u4e48\u56de\u4e8b\uff01")}},deleteSite:function(e){var t=this,r=MysiteLocalData.map[e]&&MysiteLocalData.map[e].id,i=function(e){t.relateToMysiteAndRecommandsite(e,"delete",{id:r}),t.tipsHide([v,y,g,m])};n.remove(e,function(t){t.errCode==T.NoError&&i(e)})},tipsShow:function(t,n,r){var i=e(".js-tips").getXY(),s=t.getXY(),o=s[0]-i[0]+(r&&r.width||0),u=s[1]-i[1]+(r&&r.height||-27);n.css({left:o+"px",top:u+"px"}).show();var a=r&&r.type||"click",f=r&&r.time||3e3;a=="click"&&(clearTimeout(d),d=setTimeout(function(){n.hide(),r&&r.callback&&r.callback()},f));if(t.query("input[type=text]")[0]){var l=t.query("input[type=text]")[0];l.focus(),setTimeout(function(){l.select()})}},tipsHide:function(e){var t=[].concat(e);for(var n=0,r=t.length;n<r;n++)t[n].hide()},init:function(n){var r=this;r.renderPanel(n),t.delegate(".close-mysite","click",function(e){e.preventDefault(),panelMysite.close()}).delegate(".reco-list li a","click",function(t){t.preventDefault(),LogHub.behavior("mysite","add-by-tuijian");var n=e(this),i=n.parentNode("li");if(i.hasClass(o)){var s=i.attr("data-sid");r.deleteSite(s)}else{var u={name:n.query(".name").html(),url:n.attr("href")};r.addSite(u,{type:"click",el:n})}}).delegate(".reco-list li","mouseenter",function(t){var n=e(this);n.hasClass(o)&&(r.tipsHide([v]),r.tipsShow(n,m,{type:"hover",width:n.query("a").getRect().width/2-50}))}).delegate(".reco-list li","mouseleave",function(t){var n=e(this);n.hasClass(o)&&r.tipsHide(m)}).delegate(".tips-success","mouseenter",function(t){t.preventDefault(),e(this).hide()}).delegate("#tab-list li","mouseenter",function(t){var n=e(this),i=n.attr("data-key");n.addClass("hover"),r.switchRecommendSites(i,{preload:!0})}).delegate("#tab-list li","mouseleave",function(t){e(this).removeClass("hover")}).delegate("#tab-list li","click",function(t){t.preventDefault();if(e(this).hasClass("cur"))return;var n=e(this).attr("data-key");r.switchRecoTab(n),r.initRecommendSites(n)}).delegate(".mysite-add .site-input","keydown",function(t){e(this).hasClass(u)&&(r.tipsHide(g),e(this).removeClass(u))}),e("form").on("submit",function(e){e.preventDefault(),LogHub.behavior("mysite","add-by-user");var t={name:placeholderHook(this.sitename).getVal().trim(),url:placeholderHook(this.siteurl).getVal().trim()};r.addSite(t,{type:"form",form:this})}),t.query("#btn-site-add").hover(function(t){e(this).addClass("hover")},function(t){e(this).removeClass("hover").removeClass("mousedown")}).on("mousedown",function(t){e(this).addClass("mousedown")}).on("mouseup",function(t){e(this).removeClass("hover").removeClass("mousedown")}),f.delegate("li .delete-site","click",function(t){t.preventDefault();var n=e(this).attr("data-sid");r.deleteSite(n)})}};window.CustomSites=C}),function(){function u(){if(hao360.g("reco-site")){var e="recoSite_tips",t=escape(hao360.g("tips-reco-comment").innerHTML.trim());qboot.cookie.set(e,[3,t].join("|"),{expires:2592e6}),W("#tips-reco-site").hide(),W(document).tweet("page-height-resize")}}function a(){var e=W("#mysite-list li").length-1;if(e){LogHub&&LogHub.behavior("mysite","hasData");var t=[],n=MysiteLocalData.map,r=/^http:\/\/tu.360.cn\/\w+$/,i=new MysiteSvc,s=!1;for(var o in n){var u=n[o],a=u.type;if(!a||a=="0")s=!0,r.test(u.url)?a=2:a=1,i.modify(u.sid,{type:a});var f=encodeURIComponent(u.name)+"|"+encodeURIComponent(u.url)+"|"+a;t.push(f)}s&&R("mysite-list").reRender();var e=Math.ceil(t.length/10);for(var l=0;l<e;l++){var c=t.splice(0,10);LogHub.mysiteShow(c)}}}var e=W("#hot-site"),t=W("#mysite"),n=!0,r=W("#mysite-list").attr("data-key"),i="site-input-error",s=function(){qboot.load(function(){W("#outer-extra").insertAdjacentHTML("beforeend",'<ul class="mysite-suggest" id="mysite-url-suggest" style="visibility:hidden;" width="499"></ul>'),W("#outer-extra").insertAdjacentHTML("beforeend",'<ul class="mysite-suggest" id="mysite-name-suggest" style="visibility:hidden;" width="499"></ul>')},"mysitequery"),s=function(){}},o={isShowed:!1,mask:null,resizeMaskPosition:function(){var e=W("body").getRect(),t=e.height+"px",n=e.width+"px";this.mask.css({height:t,width:n})},maskShow:function(){if(!this.isShowed){var e=W("#doc-view-front");if(Browser.ie6){var t=document.createElement("iframe");t.className="mask-iframe",e.appendChild(t)}var n=document.createElement("div");n.className="mask-panel",e.appendChild(n),this.isShowed=!0,this.mask=W(".mask-panel,.mask-iframe")}else this.mask.show();Browser.ie6&&(this.resizeMaskPosition(),W(window).on("scroll",this.resizeMaskPosition).on("resize",this.resizeMaskPosition))},maskHide:function(){this.mask.hide(),W(window).un("scroll",this.resizeMaskPosition).un("resize",this.resizeMaskPosition)},EscPress:function(e){e.keyCode==27&&o.close()},open:function(){t.removeClass("g-hide"),t.query("form")[0].sitename.focus(),e.query("#mynav").hide(),this.maskShow(),W(document).on("keydown",this.EscPress),W(document).tweet("mysite-panel-turn-on")},close:function(){W(".tips-warning,.tips-error").hide(),W(".site-input").removeClass(i),t.addClass("g-hide"),e.query("#mynav").show(),this.maskHide(),R("mysite-list").reRender(),setTimeout(function(){W(document).tweet("page-height-resize")},100),W(document).un("keydown",this.EscPress),W(document).tweet("mysite-panel-turn-off")}};window.panelMysite=o,e.delegate(".btn-add-site .btn,.btn-add-site .hxd,.mysite-manage","click",function(e){e.preventDefault(),u(),LogHub.behavior("mysite","btn-add"),W(document).tweet("mysite-editpanel-open")}).delegate("#tips-reco-site .btn-reco-site","click",function(e){e.preventDefault(),u();var t=W(this).attr("data-type");W(document).tweet("mysite-editpanel-open",{recoType:t})}).delegate(".btn-add-site","mouseenter",function(e){n&&CustomSites.switchRecommendSites(r,{preload:!0})}).delegate("#tips-reco-site .close","click",function(e){e.preventDefault(),u()}).delegate("#tips-reco-site","mouseenter",function(e){var t=W("#reco-site").attr("data-type");CustomSites.switchRecommendSites(t,{preload:!0})}).delegate(".mysite-list .site","click",function(e){var t=W(this),n=t[0].innerText,r=t.attr("href"),i=t.attr("data-type"),s=encodeURIComponent(n)+"|"+encodeURIComponent(r)+"|"+i;LogHub.mysiteClk(s)}),W(document).receive("mysite-editpanel-open",function(e){n&&CustomSites.init(e.data&&e.data.recoType),n=!1,o.open(),s()}),a()}();(function(e){var t=new MysiteSvc,n=qboot.cookie,r=mysiteTweetConf.name,i=W(".reco-info"),s=+(new Date(mysiteTweetConf.endTime)),o=+hao360.todayObj,u=s-o,a=[],f={filter:function(e){var t=MysiteLocalData.map,n=[];for(var r=0,i=e.length;r<i;r++){var s=e[r],o=SiteEnt.getSid(s.url),u=!0;for(var a in t)if(s.text==t[a].name||o==a){u=!1;break}u&&n.push(s)}return n},tweet:function(){var e=this;CustomSites.customSitesIsNotFull().then(function(s){mysiteService.getCommonUseSites().then(function(s){var o=MysiteLocalData.order.length,f=e.filter(s.coolsite);n.set(r,1,{expires:u}),LogHub.behavior("mysiteTweet","add");if(f.length<1)return;LogHub.behavior("mysiteTweet","add-success");for(var l=0,c=f.length;l<c;l++){var h=f[l],p={name:h.text,url:h.url,domain:h.domain,type:"2"};t.add(p),a.push(p)}for(var l=0,c=a.length;l<c;l++)setTimeout(function(e){return function(){W(document).tweet("mysiteTweet:add-site",e)}}(a[l]),500*l);i.show(),i.query(".num").html(f.length),R("mysite-list").reRender();var d=f.length,v=W(".mysite-list .item");for(var l=0;l<d;l++){var m=o+l;v.item(m).addClass("reco-auto")}})})}};window.mysiteTweet=f,W(document).receive("mysite-editpanel-open",function(){i.hide()}),W("#mysite-section").delegate(".know","click",function(e){e.preventDefault(),i.hide(),W(".mysite-list .item").removeClass("reco-auto")}).delegate(".delete-site","click",function(e){e.preventDefault();var t=W(this).previousSibling("a.site").attr("href"),n=SiteEnt.getSid(t),r=MysiteLocalData.map[n]&&MysiteLocalData.map[n].id;CustomSites.deleteSite(n),W(this).parentNode("li").removeNode(),LogHub.behavior("mysiteTweet","delete"),W(document).tweet("mysiteTweet:delete-site",{id:r,sid:n})})})();(function(){function a(){var t=Math.random(),a=i&&u>s&&u<o;(t<.1&&a&&!e.get(r)||n)&&mysiteTweet.tweet()}var e=qboot.cookie,t=hao360.queryUrl(location.href,"guid"),n=t?1:0,r=mysiteTweetConf.name,i=mysiteTweetConf.isOn,s=+(new Date(mysiteTweetConf.startTime)),o=+(new Date(mysiteTweetConf.endTime)),u=+hao360.todayObj;a()})();(function(){function l(){function e(e,t){var r=e.data,o=r.name,a=r.url,f=r.domain,l=r.type,c=u+"/add?htoken="+s+"&name="+o+"&url="+a+"&domain="+f+"&type="+l,h=+(new Date);t&&!personal_site_init&&(c+="&force_init=1"),n(c,function(e){var n=new SiteEnt(o,a),r=+(new Date);LogHub.mysiteDynamic("add-time",r-h);if(e.errno==0||e.errno==11003){t&&!personal_site_init&&(personal_site_init=1),e.data.id&&i.modify(n.sid,{id:e.data.id},function(){CustomSites.renderCustomSites()});return}LogHub.mysiteDynamic("add",e.errno)})}function t(e){var t=e.data,r=t.sid,i=+(new Date),o=t.id;if(o&&o!="0"){var a=u+"/del?htoken="+s+"&id="+t.id;n(a,function(e){var t=+(new Date);LogHub.mysiteDynamic("delete-time",t-i);if(e.errno==0)return;LogHub.mysiteDynamic("delete",e.errno)})}else LogHub.mysiteDynamic("delete","noid")}W(document).receive("mysite:add-site",function(t){e(t)}),W(document).receive("mysite:delete-site",function(e){t(e)}),W(document).receive("mysiteTweet:add-site",function(t){var n=1;e(t,n)}),W(document).receive("mysiteTweet:delete-site",function(e){t(e)})}if(!window.dynamic_user_data)return;var e=qboot.when,t=qboot.cookie,n=qboot.jsonp,r=Object.isArray,i=new MysiteSvc,s=dynamic_user_data&&dynamic_user_data.data.htoken,o=dynamic_user_data&&dynamic_user_data.data.is_new,u=poseidon_api_url+"/rabbit/personal_site",a=(new AppData("api.hao.360.cn",HAO_CONFIG.mysite.r)).get("mysite"),f={getLocalSites:function(){var t=e.defer();return i.getAll(function(e){e.errCode==0?t.resolve(e.res):t.reject()}),t.promise},mapId2Local:function(e,t){t.forEach(function(t,n){var r=SiteEnt.getSid(t.url);i.modify(r,{id:e[n]})})},syncData:function(e){var t=this,n=u+"/init",r={app:"personal_site",func:"init",fmt:"json",htoken:s,site_data:JSON.stringify(e),t:+(new Date)},i=+(new Date);Ajax.post(n,r,function(n){var r=+(new Date);LogHub.mysiteDynamic("init-time",r-i);var n=JSON.parse(n);if(n.errno==0){var s=n.data.ids;t.mapId2Local(s,e)}else LogHub.mysiteDynamic("init",n.errno)})},initDynamicFirst:function(e){var t=this;e!=undefined?t.syncData(e):t.getLocalSites().then(function(e){var n=[];e.forEach(function(e){n.push({url:e.url,name:e.name,type:e.type,domain:e.domain})}),t.syncData(n)})},contrastData:function(){var t=this,n=personal_site_data,i=e.defer();return r(n)?t.getLocalSites().then(function(e){var r=e.length,s=n.length;if(r==0)i.resolve({data:2});else if(n==0)i.resolve({data:1});else if(r!=0&&s!=0){var o=[],u=[];e.forEach(function(e){u.push(e.id)}),u.sort(function(e,t){return e-t}),n.forEach(function(e){o.push(e.id)}),o.sort(function(e,t){return e-t});var a=t.containsArray(u,o);i.resolve({data:a})}else i.reject()}):i.reject(),i.promise},containsArray:function(e,t){var n=null;t.length>=e.length?(source=e,dest=t):(source=t,dest=e);var r=source.length,i=dest.length,s=dest.indexOf(source[0]),o=dest.indexOf(source[r-1]);if(s>-1&&o>-1&&o-s>=r-1){var u=0;for(var a=s;a<i&&a<r;a++){var f=source[a];dest.indexOf(f)!=-1&&u++}u==r?r==i?n=0:t.length<e.length?n=1:n=2:n=-1}else n=-1;return n}};a==undefined?W(document).receive("mysite-panel-turn-on",function(e){var t=[];f.initDynamicFirst(t)}):personal_site_init?f.contrastData().then(function(e){var t="";switch(e.data){case 0:t="both";break;case 1:t="local";break;case 2:t="server";break;case-1:t="conflict";break;default:t="null"}LogHub.mysiteDynamic("init",t)}).otherwise(function(){LogHub.mysiteDynamic("init","unknow")}):f.initDynamicFirst(),l()})();M("#bangbang-r",function(e,t){function a(){var e=0,t=0;QW.W("[bone=left-var]").forEach(function(t){e+=QW.W(t).getRect().height,s.push(QW.W(t).attr("bone")+"="+QW.W(t).getRect().height)}),QW.W("[bone=right-var]").forEach(function(e){t+=QW.W(e).getRect().height,s.push(QW.W(e).attr("bone")+"="+QW.W(e).getRect().height)});var i=n+e,o=r+t;return o-i}var n=0,r=0,i=e(".bangbang-fill"),s=[];QW.W("[bone=left-def]").forEach(function(e){n+=QW.W(e).getRect().height,s.push(QW.W(e).attr("bone")+"="+QW.W(e).getRect().height)}),QW.W("[bone=right-def]").forEach(function(e){r+=QW.W(e).getRect().height,s.push(QW.W(e).attr("bone")+"="+QW.W(e).getRect().height)});var o=29,u=10;t.receive("page-height-resize",function(){var t=a();if(t>0||Math.abs(t)<o+u*1.5)i.hide();else{var n=Math.abs(t)-u*1.5;n>0?(i.css("height",n+"px").show(),e(".dam").css({height:n%o+1+"px"})):i.hide()}}),t.tweet("page-height-resize"),QW.W(window).on("load",function(){t.tweet("page-height-resize")}),window.getHeightGap=a});(function(){function E(e){d.html(e)}function S(e){clearInterval(e)}if(hao360.getFlashVer()<0||PlaneRIAConf.isOn==0)return;var e=PlaneRIAConf,t=e.direction,n=+(new Date(e.start)),r=+(new Date(e.end)),i=+hao360.todayObj,s,o;if(i<n||i>r)return;if(QW.Browser.ie&&QW.Browser.ie<7)return;t=="left"?(s='<div id="left-ria-fixed"><a href="'+e.slinkUrl+'"><img src="'+e.scaleImgUrl+'" /></a></div>',W("#doc-view-front").insert("beforeend",s)):t=="right"&&(o='<div id="right-ria-fixed" class="plane-hd"><a href="'+e.slinkUrl+'"><img src="'+e.scaleImgUrl+'" /></a></div>',W("#plane").insert("afterbegin",o));var u=500,a=1e3,f=e.displayTime||7,l=W("#"+t+"-ria-fixed"),c=W("#"+t+"-ria-fixed img"),h=W("#plane-ria"),p=W("#plane-ria .cont"),d=W("#plane-ria .time-panel .time"),v=W("#plane-ria .btn-close"),m=null,g=null,y=!0,b=['<object id="plane-flash-ria" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1000" height="400">','<param name="movie" value="'+e.flashUrl+'" width="1000" height="400">','<param name="wmode" value="transparent">','<param name="allowScriptAccess" value="always">',"<!--[if !IE]>-->",'<object id="plane-flash-ria" type="application/x-shockwave-flash" data="'+e.flashUrl+'" width="1000" height="400">','<param name="wmode" value="transparent">','<param name="allowScriptAccess" value="always">',"<!--<![endif]--><!--[if !IE]>--></object><!--<![endif]--></object>"].join(""),w='<a href="'+e.linkUrl+'" class="link">flash\u94fe\u63a5</a>',x=function(e){TweetH.receive(document,"page-size-changed",function(t){t.data.spaceWidth<=90?e.hide():e.show()})};t=="left"&&x(l),W(h).insert("beforeend",w),W(p).html(b);var T=W("#honghong").getRect().top;T>250&&W("#plane-ria").css("top",T+"px"),c.on("mouseenter",function(){if(h.hasClass("plane-ria-open"))return;var e=f;y&&(g=setTimeout(function(){y=!1,E(f),h.removeClass("plane-ria-close").addClass("plane-ria-open"),W(p).html(b);var t=W("#honghong").getRect().top;t>250&&W("#plane-ria").css("top",t+"px"),m=setInterval(function(){e--,d.html(e),e<=0&&(h.removeClass("plane-ria-open").addClass("plane-ria-close"),W(p).empty(),S(m),E(f),y=!0)},a)},u))}).on("mouseleave",function(){clearTimeout(g)}),v.on("click",function(e){e.preventDefault(),h.removeClass("plane-ria-open").addClass("plane-ria-close"),W(p).empty(),S(m),E(f),y=!0})})();(function(){var e=function(){var e=function(e){return document.getElementById(e)},t={},n="_Flash_Storage_",r="http://s8.qhimg.com/static/4622a237d238a5fa.swf",i=function(e){var t=document.createElement("div"),r=[];window.ActiveXObject?r.push('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"','codebase="http://download.macromedia.com/pub/shockwave/cabs','/flash/swflash.cab#version=10,0,0,0" width="1" height="1" id="',n,'">','<param name="allowScriptAccess" value="always" />','<param name="movie" value="',e,'" /></object>'):r.push('<embed src="',e,'" width="1" height="1" id="',n,'" ','align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" ','pluginspage="http://www.adobe.com/go/getflashplayer_cn"/>');var i=t.style;i.position="absolute",i.top="-9999px";var s=document.body;s.insertBefore(t,s.firstChild),t.innerHTML=r.join(""),document.title=document.title.split("#")[0]},s=function(e,t){t=t||function(){};var n=setInterval(function(){try{var r=e();clearInterval(n),n=null,t(r)}catch(i){}},50);setTimeout(function(){if(!n)return;clearInterval(n),t("")},5e3)};return t.init=function(){try{external.max_language_id!=undefined&&(r+="?random="+Math.random())}catch(e){}DomU.ready(function(){i(r)})},t.set=function(t,r){s(function(){e(n).set(t,r)})},t.get=function(t,r){s(function(){return e(n).get(t)},function(e){return r&&r.call(this,e),e})},t.remove=function(t){s(function(){e(n).remove(t)})},t}();e.init(),window.FlashStorage=e})();(function(){var e=hao360.todayObj,t=new Date(HotsiteColorTipsConf.start),n=new Date(HotsiteColorTipsConf.end),r=qboot.cookie.get(HotsiteColorTipsConf.name),i=!!location.href.queryUrl("huodong"),s=function(){var e=function(){W(HotsiteColorTipsConf.query).show()};return{init:function(){e()}}}();(r!=null||i)&&console&&(console.log("\u6d3b\u52a8\u5f00\u542f\u65f6\u95f4\u4e3a: ",t.toLocaleString()),console.log("\u6d3b\u52a8\u7ed3\u675f\u65f6\u95f4\u4e3a: ",n.toLocaleString())),(e>t&&e<=n||qboot.cookie.get(HotsiteColorTipsConf.name)!=null||i)&&s.init();var o=1})();